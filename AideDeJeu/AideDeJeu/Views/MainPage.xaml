<?xml version="1.0" encoding="utf-8" ?>
<MasterDetailPage xmlns="http://xamarin.com/schemas/2014/forms"
                xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                xmlns:local="clr-namespace:AideDeJeu.Views"
                xmlns:tools="clr-namespace:AideDeJeu.Tools"
                x:Class="AideDeJeu.Views.MainPage"
                x:Name="This"
                IsPresented="False"
                Title="{Binding ItemsType,Converter={StaticResource ItemTypeToStringConverter}}">
    <MasterDetailPage.Resources>
        <ResourceDictionary>
            <ControlTemplate x:Key="SpellsMasterDataTemplate">
                <ScrollView Orientation="Vertical">
                    <StackLayout Orientation="Vertical" Padding="15">

                        <Label Text="Classe" Style="{StaticResource Key=subsubsection}" />
                        <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Spells.Classes, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Spells.Classe}" />

                        <Label Text="Niveau minimum" Style="{StaticResource Key=subsubsection}" />
                        <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Spells.Niveaux, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Spells.NiveauMin}" />

                        <Label Text="Niveau maximum" Style="{StaticResource Key=subsubsection}" />
                        <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Spells.Niveaux, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Spells.NiveauMax}" />

                        <Label Text="École" Style="{StaticResource Key=subsubsection}" />
                        <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Spells.Ecoles, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Spells.Ecole}" />

                        <Label Text="Rituel" Style="{StaticResource Key=subsubsection}" />
                        <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Spells.Rituels, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Spells.Rituel}" />

                        <Label Text="Source" Style="{StaticResource Key=subsubsection}" />
                        <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Spells.Sources, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Spells.Source}" IsEnabled="False" />
                    </StackLayout>
                </ScrollView>
            </ControlTemplate>
            <ControlTemplate x:Key="MonstersMasterDataTemplate">
                <ScrollView Orientation="Vertical">
                    <StackLayout Orientation="Vertical" Padding="15">

                        <!--<Label Text="Catégorie" Style="{StaticResource Key=subsubsection}" />
                        <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Monsters.Categories, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Monsters.Category}" />-->

                        <Label Text="Type" Style="{StaticResource Key=subsubsection}" />
                        <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Monsters.Types, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Monsters.Type}" />

                        <StackLayout Orientation="Horizontal">
                            <StackLayout Orientation="Vertical">
                                <Label Text="FP minimum" Style="{StaticResource Key=subsubsection}" />
                                <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Monsters.Powers, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Monsters.MinPower}" />
                            </StackLayout>

                            <StackLayout Orientation="Vertical">
                                <Label Text="FP maximum" Style="{StaticResource Key=subsubsection}" />
                                <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Monsters.Powers, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Monsters.MaxPower}" />
                            </StackLayout>
                        </StackLayout>

                        <Label Text="Taille" Style="{StaticResource Key=subsubsection}" />
                        <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Monsters.Sizes, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Monsters.Size}" />

                        <!--<Label Text="Légendaire" Style="{StaticResource Key=subsubsection}" />
                        <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Monsters.Legendaries, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Monsters.Legendary}" />-->

                        <Label Text="Source" Style="{StaticResource Key=subsubsection}" />
                        <Picker HorizontalOptions="FillAndExpand" ItemsSource="{TemplateBinding Parent.BindingContext.Monsters.Sources, Mode=OneWay}" ItemDisplayBinding="{Binding Value, Mode=OneWay}" SelectedIndex="{TemplateBinding Parent.BindingContext.Monsters.Source}" IsEnabled="False"/>
                    </StackLayout>
                </ScrollView>
            </ControlTemplate>
            <tools:ItemTypeToStringConverter 
                x:Key="ItemTypeToStringConverter" 
                Spells="Sorts" 
                Monsters="Monstres" />
            <tools:ItemsTypeTemplateConverter 
                x:Key="ItemsTypeTemplateConverter" 
                SpellsTemplate="{StaticResource SpellsMasterDataTemplate}" 
                MonstersTemplate="{StaticResource MonstersMasterDataTemplate}" />
        </ResourceDictionary>
    </MasterDetailPage.Resources>
    <MasterDetailPage.Master>
        <ContentPage Title=" ">
            <ContentView ControlTemplate="{Binding ItemsType, Converter={StaticResource ItemsTypeTemplateConverter}}" BindingContext="{Binding}" />
        </ContentPage>
    </MasterDetailPage.Master>
    <MasterDetailPage.Detail>
        <ContentPage Title="">
            <ContentPage.ToolbarItems>
                <ToolbarItem Name="Spells" Text="Sorts" Order="Primary" Icon="spell_book.png" Command="{Binding SwitchToSpells}" />
                <ToolbarItem Name="Monsters" Text="Monstres" Order="Primary" Icon="dragon_head.png" Command="{Binding SwitchToMonsters}" />
                <ToolbarItem Name="About" Text="À propos de..." Order="Primary" Icon="wooden_sign.png" Command="{Binding AboutCommand}" />
            </ContentPage.ToolbarItems>
            <StackLayout Orientation="Vertical">
                <SearchBar x:Name="SearchBar" SearchCommand="{Binding SearchCommand}" SearchCommandParameter="{Binding Text, Source={x:Reference SearchBar}}">
                    <SearchBar.Behaviors>
                        <tools:TextChangedBehavior />
                    </SearchBar.Behaviors>
                </SearchBar>

                <ListView x:Name="ItemsListView" 
                    ItemsSource="{Binding Items}"
                    VerticalOptions="FillAndExpand"
                    HasUnevenRows="true"
                    IsRefreshing="{Binding IsBusy, Mode=OneWay}"
                    CachingStrategy="RecycleElement"
                    SelectedItem="{Binding SelectedItem}">
                    <!--RefreshCommand="{Binding LoadItemsCommand}"
                    IsPullToRefreshEnabled="true"-->

                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <ViewCell>
                                <StackLayout Padding="10">
                                    <Label Text="{Binding NamePHB}" 
                                        LineBreakMode="NoWrap" 
                                        Style="{DynamicResource subsubsection}" 
                                        FontSize="16" />
                                </StackLayout>
                            </ViewCell>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackLayout>
        </ContentPage>
    </MasterDetailPage.Detail>
</MasterDetailPage>
